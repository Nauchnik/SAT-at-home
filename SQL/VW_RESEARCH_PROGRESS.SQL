CREATE OR REPLACE VIEW VW_RESEARCH_PROGRESS AS
SELECT
    ID,
    RESEARCH_NAME_EN,
    RESEARCH_NAME_RU,
    RESEARCH_WORKUNITS_TOTAL,
    WORKUNITS_COMPLETED_BASE,

    WORKUNITS_COMPLETED_BASE +
        (SELECT COUNT(*)
           FROM WORKUNIT
          WHERE ID > RESEARCH_PROGRESS.BASE_WORKUNIT_ID
        ) AS WORKUNITS_GENERATED,

    WORKUNITS_COMPLETED_BASE +
    (SELECT COUNT(CASE WHEN CANONICAL_RESULTID > 0 THEN 1 ELSE NULL END)
       FROM WORKUNIT
      WHERE ID > RESEARCH_PROGRESS.BASE_WORKUNIT_ID) AS WORKUNITS_COMPLETED
  FROM RESEARCH_PROGRESS;